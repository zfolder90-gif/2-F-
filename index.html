<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tower Defense</title>
<style>
    body {
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #141E30, #243B55);
        font-family: Arial, sans-serif;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    .game-container {
        background: rgba(0, 0, 0, 0.85);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        position: relative;
    }

    .game-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
    }

    .stats {
        display: flex;
        gap: 20px;
    }

    .stat-value {
        font-size: 22px;
        font-weight: bold;
        color: #00ffcc;
        text-align: center;
    }

    .stat-label {
        font-size: 12px;
        opacity: 0.8;
        text-align: center;
    }

    canvas {
        border: 3px solid #00ffcc;
        border-radius: 12px;
        background: radial-gradient(circle at center, #0a0a0a 60%, #111 100%);
        box-shadow: 0 0 20px #00ffcc, inset 0 0 40px rgba(0, 255, 204, 0.2);
        display: block;
    }

    .controls {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .tower-buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }

    .tower-btn, .wave-btn {
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        background: linear-gradient(145deg, #00ffcc, #009999);
        color: white;
        cursor: pointer;
        font-weight: bold;
        font-size: 12px;
        transition: all 0.3s ease;
        box-shadow: 0 0 8px #00ffcc, inset 0 0 5px #004d4d;
    }

    .tower-btn:hover, .wave-btn:hover {
        box-shadow: 0 0 15px #00ffcc, inset 0 0 8px #00cccc;
    }

    .tower-btn:disabled {
        background: #444;
        box-shadow: none;
        cursor: not-allowed;
    }

    .wave-btn {
        font-size: 14px;
        grid-column: span 4;
        background: linear-gradient(145deg, #ff9800, #f57c00);
        box-shadow: 0 0 8px #ff9800, inset 0 0 5px #663300;
    }

    .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.95);
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        border: 3px solid #f44336;
        z-index: 10;
    }

    .restart-btn {
        margin-top: 15px;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        background: linear-gradient(145deg, #2196F3, #1976D2);
        color: white;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
    }

    .wave-popup {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 22px;
        font-weight: bold;
        color: #ffeb3b;
        text-shadow: 0 0 8px #000;
        display: none;
    }
</style>
</head>
<body>
<div class="game-container">
    <div class="game-header">
        <div class="stats">
            <div>
                <div class="stat-value" id="health">100</div>
                <div class="stat-label">HEALTH</div>
            </div>
            <div>
                <div class="stat-value" id="money">150</div>
                <div class="stat-label">GOLD</div>
            </div>
            <div>
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">SCORE</div>
            </div>
            <div>
                <div class="stat-value" id="wave">0</div>
                <div class="stat-label">WAVE</div>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div class="controls">
        <div class="tower-buttons">
            <button class="tower-btn" data-type="basic" data-cost="50">Basic ($50)</button>
            <button class="tower-btn" data-type="heavy" data-cost="120">Heavy ($120)</button>
            <button class="tower-btn" data-type="rapid" data-cost="180">Rapid ($180)</button>
            <button class="tower-btn" data-type="sniper" data-cost="300">Sniper ($300)</button>
            <button class="wave-btn" id="nextWave">â–¶ Start Wave</button>
        </div>
    </div>

    <div id="wavePopup" class="wave-popup"></div>

    <div id="gameOver" class="game-over" style="display: none;">
        <h2>Game Over!</h2>
        <p>Final Score: <span id="finalScore">0</span></p>
        <button class="restart-btn" onclick="restartGame()">Play Again</button>
    </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let gameState = {
    health: 100,
    money: 150,
    score: 0,
    wave: 0,
    gameOver: false,
    selectedTowerType: null,
    towers: [],
    enemies: [],
    projectiles: [],
    enemiesSpawned: 0,
    enemiesKilled: 0,
    waveSize: 0,
    waveActive: false
};

const path = [
    {x: 0, y: 300},
    {x: 200, y: 300},
    {x: 200, y: 100},
    {x: 400, y: 100},
    {x: 400, y: 500},
    {x: 600, y: 500},
    {x: 600, y: 200},
    {x: 800, y: 200}
];

const towerTypes = {
    basic: { cost: 50, damage: 15, range: 90, fireRate: 60, color: "#4CAF50" },
    heavy: { cost: 120, damage: 60, range: 75, fireRate: 120, color: "#FF9800" },
    rapid: { cost: 180, damage: 8, range: 100, fireRate: 15, color: "#2196F3" },
    sniper: { cost: 300, damage: 150, range: 200, fireRate: 180, color: "#9C27B0" }
};

const enemyTypes = {
    basic: { health: 80, speed: 2, reward: 8, color: "#f44336" },
    fast: { health: 50, speed: 4, reward: 12, color: "#E91E63" },
    tank: { health: 200, speed: 1.5, reward: 25, color: "#9C27B0" },
    armored: { health: 150, speed: 2, reward: 20, color: "#607D8B", armor: 0.5 },
    flying: { health: 60, speed: 3.5, reward: 15, color: "#FF9800" },
    boss: { health: 600, speed: 1.2, reward: 100, color: "#000", size: 20 }
};

// --- Classes ---
class Tower {
    constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type;
        this.config = towerTypes[type];
        this.lastFired = 0;
        this.target = null;
    }
    draw() {
        ctx.fillStyle = this.config.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
        ctx.fill();
    }
    update() {
        let closest = null;
        let closestDist = this.config.range;
        gameState.enemies.forEach(enemy => {
            const dist = Math.hypot(enemy.x - this.x, enemy.y - this.y);
            if (dist < closestDist) {
                closest = enemy;
                closestDist = dist;
            }
        });
        if (closest && Date.now() - this.lastFired > this.config.fireRate) {
            gameState.projectiles.push(new Projectile(this.x, this.y, closest, this.config.damage));
            this.lastFired = Date.now();
        }
    }
}

class Enemy {
    constructor(type) {
        this.type = type;
        this.config = {...enemyTypes[type]};
        this.health = this.config.health * (1 + gameState.wave * 0.2);
        this.maxHealth = this.health;
        this.speed = this.config.speed * (1 + gameState.wave * 0.05);
        this.pathIndex = 0;
        this.progress = 0;
        this.x = path[0].x;
        this.y = path[0].y;
    }
    draw() {
        const size = this.config.size || 12;
        ctx.fillStyle = this.config.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, size, 0, Math.PI * 2);
        ctx.fill();
        // health bar
        ctx.fillStyle = "red";
        ctx.fillRect(this.x - size, this.y - size - 8, size*2, 4);
        ctx.fillStyle = "lime";
        ctx.fillRect(this.x - size, this.y - size - 8, (this.health/this.maxHealth)*size*2, 4);
    }
    update() {
        const current = path[this.pathIndex];
        const next = path[this.pathIndex+1];
        if (!next) return false;
        const dx = next.x - current.x;
        const dy = next.y - current.y;
        const dist = Math.sqrt(dx*dx+dy*dy);
        this.progress += this.speed/dist;
        if (this.progress >= 1) {
            this.pathIndex++;
            this.progress = 0;
            if (this.pathIndex >= path.length-1) return false;
        }
        const c = path[this.pathIndex];
        const n = path[this.pathIndex+1];
        this.x = c.x + (n.x-c.x)*this.progress;
        this.y = c.y + (n.y-c.y)*this.progress;
        return true;
    }
    takeDamage(dmg) {
        let actual = dmg;
        if (this.config.armor) actual *= (1 - this.config.armor);
        this.health -= actual;
        if (this.health <= 0) {
            gameState.money += this.config.reward;
            gameState.score += this.config.reward*10;
            return true;
        }
        return false;
    }
}

class Projectile {
    constructor(x, y, target, damage) {
        this.x = x; this.y = y;
        this.target = target;
        this.damage = damage;
        this.speed = 10;
    }
    draw() {
        ctx.fillStyle = "#ffeb3b";
        ctx.beginPath();
        ctx.arc(this.x, this.y, 3, 0, Math.PI*2);
        ctx.fill();
    }
    update() {
        if (!this.target) return false;
        const dx = this.target.x - this.x;
        const dy = this.target.y - this.y;
        const dist = Math.sqrt(dx*dx+dy*dy);
        if (dist < 10) {
            if (this.target.takeDamage(this.damage)) {
                const i = gameState.enemies.indexOf(this.target);
                if (i > -1) gameState.enemies.splice(i,1);
            }
            return false;
        }
        this.x += (dx/dist)*this.speed;
        this.y += (dy/dist)*this.speed;
        return true;
    }
}

// --- Functions ---
function drawPath() {
    ctx.strokeStyle = "#444";
    ctx.lineWidth = 25;
    ctx.beginPath();
    ctx.moveTo(path[0].x, path[0].y);
    for (let i=1;i<path.length;i++) ctx.lineTo(path[i].x, path[i].y);
    ctx.stroke();
}

function spawnEnemy() {
    const waveProgress = (gameState.wave-1)*0.25;
    let type = "basic";
    const r = Math.random();
    if (gameState.wave % 10 === 0 && gameState.enemiesSpawned < 2) type = "boss";
    else if (r < 0.2+waveProgress*0.2) type = "armored";
    else if (r < 0.4+waveProgress*0.2) type = "tank";
    else if (r < 0.6+waveProgress*0.2) type = "fast";
    else if (r < 0.8+waveProgress*0.2) type = "flying";
    gameState.enemies.push(new Enemy(type));
    gameState.enemiesSpawned++;
}

function startWave() {
    if (gameState.waveActive) return;
    gameState.wave++;
    gameState.waveSize = 12 + Math.floor(gameState.wave*1.5);
    gameState.enemiesSpawned = 0;
    gameState.waveActive = true;

    // popup
    const popup = document.getElementById("wavePopup");
    popup.textContent = "âš” Wave " + gameState.wave + " Incoming!";
    popup.style.display = "block";
    setTimeout(()=>popup.style.display="none",2000);
}

function update() {
    if (gameState.gameOver) return;
    if (gameState.waveActive && gameState.enemiesSpawned < gameState.waveSize) {
        if (Math.random() < 0.04 + gameState.wave*0.01) spawnEnemy();
    }
    gameState.towers.forEach(t=>t.update());
    gameState.enemies = gameState.enemies.filter(e=>{
        const alive = e.update();
        if (!alive) {
            gameState.health -= (e.type==="boss"?40:10);
            if (gameState.health<=0) {
                gameState.gameOver=true;
                document.getElementById("gameOver").style.display="block";
                document.getElementById("finalScore").textContent=gameState.score;
            }
        }
        return alive;
    });
    gameState.projectiles = gameState.projectiles.filter(p=>p.update());
    if (gameState.waveActive && gameState.enemiesSpawned>=gameState.waveSize && gameState.enemies.length===0) {
        gameState.waveActive = false;
        gameState.money += 50 + gameState.wave*10;
    }
    updateUI();
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawPath();
    gameState.towers.forEach(t=>t.draw());
    gameState.enemies.forEach(e=>e.draw());
    gameState.projectiles.forEach(p=>p.draw());
}

function updateUI() {
    document.getElementById("health").textContent=gameState.health;
    document.getElementById("money").textContent=gameState.money;
    document.getElementById("score").textContent=gameState.score;
    document.getElementById("wave").textContent=gameState.wave;
    document.querySelectorAll(".tower-btn").forEach(btn=>{
        const cost = parseInt(btn.dataset.cost);
        btn.disabled = gameState.money < cost;
    });
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

function restartGame() {
    gameState = {
        health: 100, money: 150, score: 0, wave: 0,
        gameOver: false, selectedTowerType: null,
        towers: [], enemies: [], projectiles: [],
        enemiesSpawned: 0, enemiesKilled: 0,
        waveSize: 0, waveActive: false
    };
    document.getElementById("gameOver").style.display="none";
}

document.querySelectorAll(".tower-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
        gameState.selectedTowerType = btn.dataset.type;
    });
});
canvas.addEventListener("click",e=>{
    if (!gameState.selectedTowerType) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const cost = towerTypes[gameState.selectedTowerType].cost;
    if (gameState.money >= cost) {
        gameState.towers.push(new Tower(x,y,gameState.selectedTowerType));
        gameState.money -= cost;
        gameState.selectedTowerType=null;
    }
});
document.getElementById("nextWave").addEventListener("click",startWave);

gameLoop();
</script>
</body>
</html>
