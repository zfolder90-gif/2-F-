<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Tower Defense â€” Ensemble Spawn</title>
<style>
  html,body{margin:0;height:100%;background:#0b1220;color:#ddd;font-family:sans-serif;}
  canvas{display:block;width:100%;height:100%;background:linear-gradient(180deg,#12202b,#0b1220);}
  #hud{position:absolute;top:8px;left:8px;background:rgba(0,0,0,0.5);padding:8px;border-radius:8px;font-size:14px}
  #sidebar{position:absolute;right:8px;top:60px;width:140px;background:rgba(0,0,0,0.5);border-radius:12px;padding:10px}
  .tower-btn{display:flex;align-items:center;gap:8px;padding:6px;margin:4px 0;background:rgba(255,255,255,0.05);border-radius:6px;cursor:pointer}
  .tower-btn.selected{outline:2px solid #68b0f3}
  #controls{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:10px}
  #controls button{padding:8px 14px;background:rgba(0,0,0,0.5);color:#fff;border:none;border-radius:8px}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="hud">
  ğŸ’° <span id="money">100</span>  
  â¤ï¸ <span id="hp">20</span>  
  ğŸŒŠ <span id="wave">0</span>
</div>
<div id="sidebar">
  <div style="font-weight:700;margin-bottom:6px">Towers</div>
  <div class="tower-btn" data-type="basic">ğŸ”« Basic (50)</div>
  <div class="tower-btn" data-type="slow">â„ï¸ Slow (70)</div>
  <div class="tower-btn" data-type="missile">ğŸš€ Missile (120)</div>
  <div class="tower-btn" data-type="laser">ğŸ”¦ Laser (150)</div>
  <div class="tower-btn" data-type="flame">ğŸ”¥ Flame (100)</div>
  <div class="tower-btn" data-type="sniper">ğŸ¯ Sniper (200)</div>
</div>
<div id="controls">
  <button id="startWave">Start Wave</button>
  <button id="pauseBtn">Pause</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener('resize',resize);resize();

let money=100,hp=20,wave=0,paused=false;
let enemies=[],towers=[],bullets=[],selectedType=null;

const TOWERS={
  basic:{cost:50,range:90,rate:0.6,damage:10,icon:"ğŸ”«"},
  slow:{cost:70,range:100,rate:1,damage:2,slow:0.5,icon:"â„ï¸"},
  missile:{cost:120,range:150,rate:1.5,damage:20,splash:40,icon:"ğŸš€"},
  laser:{cost:150,range:120,rate:0.1,damage:3,beam:true,icon:"ğŸ”¦"},
  flame:{cost:100,range:70,rate:0.2,damage:1,aoe:50,icon:"ğŸ”¥"},
  sniper:{cost:200,range:260,rate:2.5,damage:60,icon:"ğŸ¯"}
};
const ENEMIES=[
  {hp:30,speed:40,reward:10,color:"#f5d76e"},
  {hp:18,speed:80,reward:8,color:"#9be7ff"},
  {hp:90,speed:25,reward:20,color:"#ff9fb1"}
];
let path=[{x:50,y:canvas.height*0.7},{x:200,y:canvas.height*0.7},{x:400,y:canvas.height*0.5},{x:650,y:canvas.height*0.5},{x:900,y:canvas.height*0.65},{x:canvas.width-50,y:canvas.height*0.65}];

function distance(ax,ay,bx,by){return Math.hypot(ax-bx,ay-by);}
function spawnWave(){
  wave++;document.getElementById("wave").textContent=wave;
  enemies=[];
  let count=6+wave*2;
  for(let i=0;i<count;i++){
    let type=Math.floor(Math.random()*ENEMIES.length);
    let def=ENEMIES[type];
    enemies.push({x:path[0].x,y:path[0].y,hp:def.hp+wave*4,speed:def.speed, reward:def.reward+wave, color:def.color,wp:0});
  }
}
function placeTower(x,y){
  if(!selectedType)return;
  let def=TOWERS[selectedType];
  if(money<def.cost)return;
  towers.push({x,y,type:selectedType,cd:0});
  money-=def.cost;document.getElementById("money").textContent=money;
}
canvas.addEventListener("click",e=>{
  placeTower(e.offsetX,e.offsetY);
});
document.querySelectorAll(".tower-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tower-btn").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");selectedType=btn.dataset.type;
  });
});
document.getElementById("startWave").onclick=()=>{if(!paused)spawnWave();};
document.getElementById("pauseBtn").onclick=()=>{paused=!paused;};

function update(dt){
  if(paused)return;
  // enemies
  for(let e of enemies){
    let target=path[e.wp+1];
    if(!target)continue;
    let dx=target.x-e.x,dy=target.y-e.y,d=Math.hypot(dx,dy);
    let step=e.speed*dt/1000;
    if(d<step){e.wp++;if(e.wp>=path.length-1){hp--;document.getElementById("hp").textContent=hp;enemies=enemies.filter(x=>x!==e);} }
    else{e.x+=dx/d*step;e.y+=dy/d*step;}
  }
  // towers
  for(let t of towers){
    let def=TOWERS[t.type];
    t.cd-=dt/1000;
    let target=enemies.find(e=>distance(e.x,e.y,t.x,t.y)<def.range);
    if(target&&t.cd<=0){
      t.cd=def.rate;
      if(def.beam){target.hp-=def.damage;}
      else if(def.aoe){for(let e of enemies){if(distance(e.x,e.y,target.x,target.y)<def.aoe)e.hp-=def.damage;}}
      else if(def.splash){bullets.push({x:t.x,y:t.y,target,damage:def.damage,splash:def.splash,speed:250});}
      else{target.hp-=def.damage;if(def.slow)target.speed*=def.slow;}
    }
  }
  // bullets
  for(let b of bullets){
    let dx=b.target.x-b.x,dy=b.target.y-b.y,d=Math.hypot(dx,dy);
    let step=b.speed*dt/1000;
    if(d<step){if(b.splash){for(let e of enemies){if(distance(e.x,e.y,b.target.x,b.target.y)<b.splash)e.hp-=b.damage;}}else{b.target.hp-=b.damage;} b.dead=true;}
    else{b.x+=dx/d*step;b.y+=dy/d*step;}
  }
  bullets=bullets.filter(b=>!b.dead);
  // cleanup dead enemies
  for(let e of [...enemies]){if(e.hp<=0){money+=e.reward;document.getElementById("money").textContent=money;enemies=enemies.filter(x=>x!==e);}}
}
function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // path
  ctx.strokeStyle="rgba(255,255,255,0.1)";ctx.lineWidth=20;ctx.beginPath();ctx.moveTo(path[0].x,path[0].y);
  for(let p of path)ctx.lineTo(p.x,p.y);ctx.stroke();
  // enemies
  for(let e of enemies){ctx.fillStyle=e.color;ctx.beginPath();ctx.arc(e.x,e.y,12,0,Math.PI*2);ctx.fill();}
  // towers
  for(let t of towers){ctx.fillStyle="#fff";ctx.fillText(TOWERS[t.type].icon,t.x,t.y);}
  // bullets
  ctx.fillStyle="#ff0";for(let b of bullets){ctx.beginPath();ctx.arc(b.x,b.y,4,0,Math.PI*2);ctx.fill();}
}
let last=0;function loop(ts){let dt=ts-last;last=ts;update(dt);render();requestAnimationFrame(loop);}requestAnimationFrame(loop);
</script>
</body>
</html>
