<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Advanced TD v2 ‚Äî More Towers & Difficulties</title>
<style>
  :root{--bg:#071018;--panel:rgba(255,255,255,0.05);--accent:#68b0f3}
  html,body{height:100%;margin:0;background:var(--bg);color:#dfe7ef;font-family:system-ui, -apple-system, Roboto, Arial;}
  #app{height:100%;display:flex;flex-direction:column}
  header{padding:10px 12px;display:flex;justify-content:space-between;align-items:center}
  #wrap{flex:1;position:relative}
  canvas{display:block;width:100%;height:100%;background:linear-gradient(180deg,#08202a,#051018)}
  #ui{position:absolute;right:12px;top:70px;width:270px;background:var(--panel);border-radius:12px;padding:10px;backdrop-filter:blur(6px)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  button{padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;cursor:pointer}
  .tower-btn{display:flex;gap:6px;align-items:center;padding:6px;border-radius:8px;background:rgba(255,255,255,0.04);cursor:pointer;justify-content:center}
  .tower-btn.selected{outline:2px solid var(--accent)}
</style>
</head>
<body>
<div id="app">
  <header>
    <div style="font-weight:700;font-size:16px">Advanced TD v2</div>
    <div class="row"><div>üí∞ <span id="money">120</span></div><div>‚ù§Ô∏è <span id="hp">20</span></div><div>üåä <span id="wave">0</span></div></div>
  </header>

  <div id="wrap">
    <canvas id="gameCanvas"></canvas>

    <div id="ui">
      <div style="font-weight:700;margin-bottom:6px">Towers</div>
      <div id="towerList" style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px"></div>

      <div style="font-weight:700;margin-bottom:6px">Difficulty</div>
      <div class="row" style="margin-bottom:8px">
        <button class="diffBtn" data-mode="easy">Easy</button>
        <button class="diffBtn" data-mode="normal">Normal</button>
        <button class="diffBtn" data-mode="hard">Hard</button>
        <button class="diffBtn" data-mode="insane">Insane</button>
      </div>

      <div class="row" style="margin-bottom:6px">
        <button id="startWave">Start Wave</button>
        <button id="pauseBtn">Pause</button>
      </div>

      <div class="row"><button id="resetBtn">Reset</button><button id="saveBtn">Save</button><button id="loadBtn">Load</button></div>
    </div>
  </div>
</div>

<script>
// --- Game Setup ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ const rect = canvas.getBoundingClientRect(); const dpr = window.devicePixelRatio||1; canvas.width=rect.width*dpr; canvas.height=rect.height*dpr; ctx.setTransform(dpr,0,0,dpr,0,0);} window.addEventListener('resize',resizeCanvas); resizeCanvas();

let state = { money:120, hp:20, wave:0, enemies:[], towers:[], bullets:[], spawnQueue:[], paused:false, diff:"normal" };
const moneyEl=document.getElementById('money'); const hpEl=document.getElementById('hp'); const waveEl=document.getElementById('wave');
function updateUI(){moneyEl.textContent=state.money;hpEl.textContent=state.hp;waveEl.textContent=state.wave;}

// Path
const pathPct=[{x:0.05,y:0.75},{x:0.22,y:0.75},{x:0.42,y:0.55},{x:0.62,y:0.55},{x:0.82,y:0.7},{x:0.97,y:0.7}];
function wpToPx(wp){const r=canvas.getBoundingClientRect();return{x:wp.x*r.width,y:wp.y*r.height};}

// Towers
const TOWERS={
  basic:{cost:50,range:90,rate:0.6,damage:12,icon:'üî´'},
  slow:{cost:70,range:100,rate:1.0,damage:2,slow:0.5,icon:'‚ùÑÔ∏è'},
  missile:{cost:120,range:150,rate:1.5,damage:20,splash:36,icon:'üöÄ'},
  laser:{cost:150,range:120,rate:0.08,damage:2,beam:true,icon:'üî¶'},
  flame:{cost:100,range:70,rate:0.2,damage:3,aoe:40,icon:'üî•'},
  sniper:{cost:200,range:260,rate:2.5,damage:60,icon:'üéØ'},
  railgun:{cost:300,range:400,rate:3.0,damage:120,pierce:true,icon:'üí•'},
  tesla:{cost:250,range:160,rate:1.2,damage:15,chain:3,icon:'‚ö°'},
  mortar:{cost:220,range:200,rate:2.8,damage:80,splash:60,icon:'üí£'},
  poison:{cost:180,range:110,rate:1.0,damage:5,dot:4,icon:'‚ò†Ô∏è'},
  freezer:{cost:200,range:100,rate:1.5,damage:1,slow:0.2,icon:'üßä'}
};
const TOWER_ORDER=Object.keys(TOWERS);

const towerList=document.getElementById('towerList'); let selectedType=null;
function buildTowerButtons(){towerList.innerHTML=''; for(const key of TOWER_ORDER){const def=TOWERS[key]; const el=document.createElement('div'); el.className='tower-btn'; el.innerHTML=`<div style="font-size:20px">${def.icon}</div><div style="font-size:11px">${def.cost}</div>`; el.addEventListener('click',()=>{document.querySelectorAll('.tower-btn').forEach(b=>b.classList.remove('selected')); el.classList.add('selected'); selectedType=key;}); towerList.appendChild(el);} }
buildTowerButtons();

canvas.addEventListener('pointerdown',e=>{if(selectedType) placeTower(e.offsetX,e.offsetY);});
function placeTower(x,y){const def=TOWERS[selectedType]; if(!def||state.money<def.cost)return; state.towers.push({id:Date.now()+Math.random(),type:selectedType,x,y,range:def.range,damage:def.damage,rate:def.rate,lastShot:0}); state.money-=def.cost; updateUI();}

// Difficulties
const diffBtns=document.querySelectorAll('.diffBtn');
diffBtns.forEach(b=>b.addEventListener('click',()=>{state.diff=b.dataset.mode; flash("Mode: "+state.diff);}));

// Enemies
const ENEMY_TYPES=[{hp:30,speed:44,reward:10,color:'#F6D365'},{hp:18,speed:84,reward:8,color:'#9BE7FF'},{hp:90,speed:28,reward:24,color:'#FF9FB1'}];

function startWave(){if(state.spawnQueue.length>0||state.enemies.length>0)return; state.wave++; updateUI(); let base=6+Math.floor(state.wave*1.6); let mult=1; if(state.diff=="easy") mult=0.8; if(state.diff=="hard") mult=1.5; if(state.diff=="insane") mult=2;
  for(let i=0;i<base;i++){const type=Math.random()<0.25?1:0; const def=ENEMY_TYPES[type]; const s=wpToPx(pathPct[0]); state.spawnQueue.push({id:Date.now()+Math.random(),type,x:s.x,y:s.y,hp:def.hp*mult*(1+state.wave*0.12),maxHp:def.hp,speed:def.speed*mult,reward:def.reward,color:def.color,wp:0});}}

// Loop
let last=performance.now(); let spawnTimer=0; function loop(ts){const dt=ts-last; last=ts; if(!state.paused) update(dt/1000); render(); requestAnimationFrame(loop);} requestAnimationFrame(loop);

function update(dt){ if(state.spawnQueue.length>0){spawnTimer+=dt; if(spawnTimer>=0.8){state.enemies.push(state.spawnQueue.shift()); spawnTimer=0;}}
 for(let i=state.enemies.length-1;i>=0;i--){const e=state.enemies[i]; const next=pathPct[Math.min(e.wp+1,pathPct.length-1)]; const tgt=wpToPx(next); const dx=tgt.x-e.x,dy=tgt.y-e.y,dist=Math.hypot(dx,dy); const step=e.speed*dt; if(dist<step){if(e.wp<pathPct.length-1) e.wp++; else {state.hp--; state.enemies.splice(i,1); if(state.hp<=0) flash("Game Over");}} else {e.x+=dx/dist*step; e.y+=dy/dist*step;}}
 for(const t of state.towers){t.lastShot+=dt; const def=TOWERS[t.type]; if(t.lastShot>=def.rate){let target=state.enemies[0]; if(target){t.lastShot=0; target.hp-=def.damage; if(def.slow) target.speed*=def.slow;}}}
 for(let i=state.enemies.length-1;i>=0;i--){if(state.enemies[i].hp<=0){state.money+=state.enemies[i].reward; state.enemies.splice(i,1);}}
 updateUI();}

function render(){const r=canvas.getBoundingClientRect(); ctx.clearRect(0,0,r.width,r.height); ctx.lineWidth=20; ctx.strokeStyle='rgba(255,255,255,0.08)'; ctx.beginPath(); ctx.moveTo(wpToPx(pathPct[0]).x,wpToPx(pathPct[0]).y); for(let i=1;i<pathPct.length;i++){const p=wpToPx(pathPct[i]); ctx.lineTo(p.x,p.y);} ctx.stroke();
 for(const e of state.enemies){ctx.fillStyle=e.color; ctx.beginPath(); ctx.arc(e.x,e.y,12,0,Math.PI*2); ctx.fill();}
 for(const t of state.towers){ctx.save(); ctx.translate(t.x,t.y); ctx.fillStyle='#222'; ctx.fillRect(-16,-16,32,32); ctx.fillStyle='#fff'; ctx.font='18px system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(TOWERS[t.type].icon,0,0); ctx.restore();}}

function flash(msg){console.log(msg);}
document.getElementById('startWave').addEventListener('click',startWave);
document.getElementById('pauseBtn').addEventListener('click',()=>{state.paused=!state.paused;});
document.getElementById('resetBtn').addEventListener('click',()=>{state={money:120,hp:20,wave:0,enemies:[],towers:[],bullets:[],spawnQueue:[],paused:false,diff:state.diff}; updateUI();});
</script>
</body>
</html>
